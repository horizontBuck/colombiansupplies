<div class="modal fade" id="register-modal">
  <div class="modal-dialog modal-dialog-centered ">
    <div class="modal-content">

      <div class="modal-header d-flex align-items-center justify-content-between pb-0 border-0 w-100">
        <div class="stepper">
          <div class="step" [class.done]="currentStep>1" [class.active]="currentStep===1">1</div>
          <div class="line" [class.active]="currentStep>1"></div>
          <div class="step" [class.done]="currentStep>2" [class.active]="currentStep===2">2</div>
          <div class="line" [class.active]="currentStep>2"></div>
          <div class="step" [class.active]="currentStep===3">3</div>
        </div>
        <a href="javascript:void(0);" data-bs-dismiss="modal" aria-label="Close">
          <i class="ti ti-x fs-20"></i>
        </a>
      </div>

      <div class="modal-body p-4 pt-0">
        <div *ngIf="errorMsg" class="alert alert-danger py-2">{{ errorMsg }}</div>
        <div *ngIf="okMsg" class="alert alert-success py-2">{{ okMsg }}</div>

        <!-- Enlaza el Reactive Form -->
        <form [formGroup]="form" (ngSubmit)="submit()">

          <!-- PASO 1: Tipo -->
          <section *ngIf="currentStep === 1">
            <div class="text-center border-bottom mb-3">
              <h5 class="mb-1">Regístrate</h5>
              <p class="mb-3">Crea tu cuenta</p>
            </div>

            <label class="form-label d-block text-center mb-3">Tipo de cuenta</label>
            <div class="d-flex justify-content-center gap-4">
              <div class="account-option"
                   [class.active]="selectedAccountType === 'cliente'"
                   (click)="setAccountType('cliente')">
                <img src="assets/img/buyer.png" alt="Cliente">
                <p class="account-label">Cliente</p>
              </div>
              <div class="account-option"
                   [class.active]="selectedAccountType === 'proveedor'"
                   (click)="setAccountType('proveedor')">
                <img src="assets/img/seller.png" alt="Proveedor">
                <p class="account-label">Artesano</p>
              </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
              <span></span>
              <button type="button" class="btn btn-primary" (click)="next()">Continuar</button>
            </div>
          </section>

          <!-- PASO 2: Datos -->
          <section *ngIf="currentStep === 2">
            <div class="row g-3">
              <div class="col-lg-6">
                <label class="form-label">Tu nombre</label>
                <input formControlName="name" class="form-control form-control-lg" placeholder="Tu nombre">
                <small class="text-danger" *ngIf="form.get('name')?.touched && form.get('name')?.invalid">
                  Ingresa tu nombre (mín. 2 caracteres)
                </small>
              </div>

              <div class="col-lg-6">
                <label class="form-label">Email</label>
                <input formControlName="email" type="email" class="form-control form-control-lg" placeholder="Email">
                <small class="text-danger" *ngIf="form.get('email')?.touched && form.get('email')?.invalid">
                  Email inválido
                </small>
              </div>

              <div class="col-lg-6">
                <label class="form-label">Contraseña</label>
                <input formControlName="password" type="password" class="form-control form-control-lg" placeholder="Contraseña">
                <small class="text-danger" *ngIf="form.get('password')?.touched && form.get('password')?.invalid">
                  Mínimo 6 caracteres
                </small>
              </div>

              <div class="col-lg-6">
                <label class="form-label">Confirmar Contraseña</label>
                <input formControlName="confirmPassword" type="password" class="form-control form-control-lg" placeholder="Confirmar Contraseña">
                <small class="text-danger" *ngIf="form.errors?.['passwordMismatch'] && form.get('confirmPassword')?.touched">
                  Las contraseñas no coinciden
                </small>
              </div>

              <div class="col-12" *ngIf="selectedAccountType === 'proveedor'">
                <label class="form-label">Nombre comercial (Proveedor)</label>
                <input formControlName="companyName" class="form-control form-control-lg" placeholder="Taller / Empresa / Tienda">
                <small class="text-danger" *ngIf="form.get('companyName')?.touched && form.get('companyName')?.invalid">
                  Obligatorio para proveedores
                </small>
              </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
              <button type="button" class="btn btn-outline-secondary" (click)="back()">Atrás</button>
              <button type="button" class="btn btn-primary" (click)="next()" [disabled]="!isStepValid()">Continuar</button>
            </div>
          </section>

          <!-- PASO 3: Términos -->
          <section *ngIf="currentStep === 3">
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" id="agree" type="checkbox" formControlName="agree">
                <label class="form-check-label" for="agree">
                  Acepto los <a href="javascript:void(0);" class="link-primary fw-medium">Términos y Condiciones</a>.
                </label>
              </div>
              <small class="text-danger" *ngIf="form.get('agree')?.touched && form.get('agree')?.invalid">
                Debes aceptar los términos
              </small>
            </div>

            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-outline-secondary" (click)="back()">Atrás</button>
              <button type="submit" class="btn btn-success" [disabled]="loading || !isStepValid()">
                <span *ngIf="!loading">Registrarte</span>
                <span *ngIf="loading">Creando cuenta…</span>
              </button>
            </div>
          </section>
        </form>

        <!-- SIEMPRE visible -->
        <div class="login-or my-3"><span class="span-or">O</span></div>
        <div class="d-flex align-items-center mb-2">
          <a class="btn btn-light flex-fill d-flex align-items-center justify-content-center me-2" href="javascript:void(0);">
            <img src="assets/img/icons/google-icon.svg" class="me-2" alt="Google">Regístrate con Google
          </a>
        </div>
      </div>

    </div>
  </div>
</div>
